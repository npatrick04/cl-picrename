;;;; Picture renamer

;;(in-package :cl-picrename)

(ql:quickload "cl-opengl")   ; load OpenGL bindings
(ql:quickload "cl-glu")      ; load GLU bindings
(ql:quickload "cl-glut")     ; load GLUT bindings
(ql:quickload "cl-devil")
(ql:quickload "bordeaux-threads")
(ql:quickload "closer-mop")
(ql:quickload "alexandria")
;;(asdf:load-system "fsm")
(load "../fsm/fsm.lisp")
(asdf:load-system "utilities")

(defvar *config-file* ".renamerrc")
(defvar *list-of-files* '())
(defvar *inputmap* (make-hash-table :test #'eq))
(defvar *name-pattern* "<names> <description> <#> <date>")
(defvar *title-format* "狺［犷夯蔺铛溽翦アㄤ彐鲠钺礤轭痱镧蝈篌ㄤ彐鲠碱犴弩铋飑ㄤ彐鲠间弩泸轲糸镱扉篝┅ㄤ彐鲠间狒寰铋飑ㄤ彐鲠沲蝌孱舡黠蜾ㄤ彐鲠篝狒濯ч潇濠换殇戾铄鳜铄翩殪瀣盹溟骈邃箦舡钺礤箦舡溴筱蜷痿轱瞵孱翦颦溴筱蜷痿轱瞵孱翦颦钺礤ㄤ彐疳蜥礤翦痱镯痿痱镯痿劲ㄤ彐疳蜥礤翦秕篝犷溽蜾秕麴豸ㄤ彐鲠痱镯痿祜汶ㄢ矧溴狨翳蝈徜蠛磲脲祜汶┅ㄤ彐沆狍黠蜾īè翳瀛汨狎横沣弩箫翳瀛汨狎洪铋翎蜱呼桢汨狎洪铋翩矧ㄥ蝌矧Ⅳ桢汨狎铄邃麸忮痱秭殇邃┅黠蜾横沣弩箫黠蜾洪铋翎蜱瑚矧洪铋翩矧ㄥ蝌矧⒆矧铄邃麸忮痱秭殇邃┅┅ㄤ彐沆狍溴筱蜷痿轱黠蜾īㄤ彐躅蝈钺礤ㄦ殪灞骈戾博ㄦ矧磲秕⒚桢汶翳狒骈戾屮轶趔犷滹弩瞌酤ヒ孱犴麸狺ア骈戾骈戾博ㄤ彐躅麸珑戾钺礤钺礤ㄩㄦ轭钺礤碱犴弩京ㄤ屐弭钺礤碱犴弩京瘐箬钺礤碱犴弩京┅ㄤ彐躅珏舡扉篝镦骈戾ī扉篝栾礤铋汶扉箴沆痖泸孱犴瀵屮犴痨弩舶辈安氨背狈幢牮纰栾礤铋汶扉箴沆痖泸孱犴瀵屮犴痨弩舶辈安氨背备肮牮纰栾礤铋汶扉箴沆痖泸孱犴瀵屮犴痨弩舶辈安俺钡吵刀牮纰栾礤铋汶扉箴沆痖泸孱犴瀵屮犴痨弩舶辈安俺钡炒案牮纰┅ㄤ彐躅黠蜾蟓羼踽祓ㄣ悴ㄥ翳瀛汨狎惚翳瀛汨狎悴┅ㄤ彐躅泔眇殪瀛钺礤īㄦ矧磲铋糸綮瀛骘蝽狒磲疸狎灬礅溽钺礤黠蜾钺礤┅碱犴弩京ㄣ狎间弩泸轲糸镱京┅ㄤ彐躅蝈鲥螋溴筱蜷痿轱铛愆戾è溴筱铘铛间弩泸轲糸镱京┅ㄣ镱ㄤ弩瘐箬溴筱间弩泸轲糸镱京瘐箬ㄣ狎灬篝间弩泸轲糸镱京间弩泸轲糸镱京┅┅ㄤ彐躅磲脲溴筱蜷痿轱ī戾舄è溴筱痱镯痿蝈徜⒛弩泸轲糸镱矧０９骘痱弼轱躞溴筱蜷痿轱铙┅铛ㄨ犷潇弪汜箦疳蝮瀛轭翦珏溴筱ㄥ蝌矧ī铋飑┅ㄣ镱è犷铛磲黹铛供癌蝈鲥螋溴筱蜷痿轱铛愆铛磲脲溴筱蜷痿轱瞟瘐箬溴筱间弩泸轲糸镱京┅ㄤ屐弭瀛漉痨殂狒弩间弩泸轲糸镱烘蝻憝孱舂┅ㄤ彐躅磲脲钺礤ㄩ铕豸汨狎戾舄è钺礤痱镯痿蝈徜⑽犴澧┅钺礤镡赍泗磲脲轭篝犷沐黠蜾瑚矧钺礤呼桢汨狎轭瘐舡汨狎┅箦翩ㄧ弭栳箬轭瘐舡汨狎轭瘐繇狃钺礤镡赍泗麸珑戾钺礤钺礤镡赍泗┅ㄦ箜轰彐骟轭瘐舡骟īè翳瀛脲横沣弩箫翳瀛脲┅ㄦ箜轰彐篝狒轭瘐舡骟洪铋糸犰ㄦ箜悌戾è轭磲痧邃ㄧ弭栳箬轭瘐繇狃┅ㄣ镱ㄩ瞽磲痧邃痱镧麸珑戾钺礤轭磲痧邃侯犴邃┅痱镧箦翩翳瀛脲骟愆悌ㄦ矧磲秕⒚栳蜥泗弪连忮玳铑轭钺黹铉ア悌箦翩痱镯痿ㄦ矧磲铋⑽犴俩悌侯犴轭绌┅┅ㄦ箜轰彐篝狒轭瘐舡骟侯犴邃ㄦ箜悌ㄣ狍ǎ芪鬻扉铄崎铋箬翳钺礤镦翳骈戾痱镧蝈钺礤痫扉篝镦骈戾螵ㄣ镯痖戾钺礤┅箦翩碱犴弩铋飑洪铋糸犰┅雉桢蝼轶戾è轭磲痧邃ㄧ弭栳箬轭瘐繇狃┅ㄣ镱ㄩ瞽磲痧邃痱镧麸珑戾钺礤轭磲痧邃ㄦ矧磲秕⒚栳蜥泗弪轭磲瘙ア悌换柔鲥麸汨邈殒麇鲥趱蝾邃镦钺礤ㄩ矧碱犴弩间弩泸轲糸镱京侯犴邃洪铋糸犰┅痱镧箦翩翳瀛脲骟愆悌ㄦ矧磲秕⒚栳蜥泗弪连忮玳铑轭钺黹铉ア悌箦翩痱镯痿ㄦ矧磲铋⑽犴俩悌侯犴轭绌┅┅┅ㄦ箜轰彐篝狒轭瘐舡骟侯犴轭ㄦ箜悌ㄣ狍ǎ芪鬻扉铄痱镧蝈钺礤痫扉篝镦骈戾螵ㄣ镯痖戾钺礤┅ㄦ矧磲秕ッ栳蜥泗弪箦麸立翳瀛脲骟愆钺礤轭痱镧蝈篌箦翩碱犴弩铋飑┅痱镧ㄣ镱汜翦钺翦篝蜷铉钺礤轭痱镧蝈篌扉篝悌ㄦ矧磲秕立悌ㄢ矧溴狨翳蝈徜蠛徙聃轵瀛祜汶痱镯痿祜汶ㄣ镱汜翦钺翦篝蜷铉痱镯痿扉篝悌ㄢ矧溴狨翳蝈徜蠛蝈戾狍瀛祜汶痱镯痿祜汶侯犴轭绌┅ㄤ彐疳蜥礤翦翳瀛骟愍磲脲轭篝犷沐ч铕豸骟愆换ㄦ矧磲⒚镯磲钿簋レ田徜铄骈戾簋セ歪脲铄溴筱蜷痿轱铪ゼ五魈轭寰砒邈豸蝈钺黹铉镦骈戾换ㄦ矧磲⒃徜钺礤蟋轭轸獒祆豉疱翳戾趑弪麒殂鏖祆痱秭殇翳栾綦妁骘翳疱蝮镱秕麽铘麸徜洚プ桢痱镯痿邃豉疱翳钺礤犷栝孱翦虍吁怏羼蹂铘躞镦翳狒戾趑弪栾綦妁鏖祆蝈篚祠轭翳麸珑扉铉镦翳狒疱蝮镱钺礤アㄤ彐疳蜥礤翦秕篝犷溽蜾秕麴豸ㄤ彐疳蜥礤翦翳瀛鏖钿秣铋飑ㄤ彐沆狍睐鏖钿秣ㄧ祯艉鏖钿秣è骢祆筱蝈孱洪铋翎蜱烘蹯祗泸邋候遽溴骢祆筱蝈孱皓翦趱蝈殇洪铋翩矧铋横沣弩箫翦趱蝈殇┅ê溴驷蹯舡轭轸狎珞瑚殇翳窗鸿彘玷嘲呼轸戾⒁孱犴弪壶卑葫卑喉镤Ж轰秕忪候玮轰屦翳烘蹯祗泸邋铋呼殂氕轭翦蝣犰蝻躅卑鞍栋┅黹祆轶邈镱潴疱糸汶ㄤ彐礤翳镤珈豸呼殂è鏖睐鏖钿秣┅ㄧ祯艉痫篝蝈溟箴灬┅翦祆翘赵麸蝈潋狩ㄤ彐礤翳镤珈豸轰轶痨狴鏖钿秣衡彐矧è鏖睐鏖钿秣┅ㄧ旌箬徜瀛盹溴后盹雉瑭孱徕戾箜镲翳箬徜轭ㄧ旌沆遽颦泔祜癌忉汶珧秕钿鏖祆忮忪徙ㄧ旌沆遽颦溴痿暴沆遽怩骀弪麸磲轫蹴溴痿ㄧ旌孱徕戾轰屦翳翦篝孱徕戾溴痿翦篝轭ㄧ旌溴痿璀骢钽红羼踽飑镫狴麸黩轸痖屐殒轸溴痿轶戾篌翳犷矧羼踽麸翳溴痿沲蝌孱綮黩轸翦蝈犰禊铋沐疱蝮疱泗轹泔蝌邈糸镱ㄧ旌栝铘吼弪箴邈糸鲥泔蝌邈糸镱栝铘侯殂弩舂麒孱ㄦ蹯祗泸邋瞽鏖瞟汨邈麸箦殒骢祆筱蝈孱铄邃邃ㄧ祯艉骢祆筱蝈孱┅殒箫翳孱翦祆翘赵躅戾篌翦趱蝈殇鏖瞟祜徜翦趱蝈殒铄邃邃箦翩翦趱蝈殇鏖瞟ㄩ旌鏖翳轭轸ㄩ祯艉蝈钿弪弪猴疱铉飑ㄩ祯艉珈祜徜轫徵栾礤铋汶舶辈按胺肮惫党牮纰┅┅换ㄩ祯艉珈祜徜轫徵栾礤铋汶舶辈按胺肮惫党牮纰┅┅换ㄩ祯艉珈祜徜轫徵栾礤铋汶扉箴沆痖泸孱犴瀵屮犴痨弩痖惚牮纰┅┅麒孱翦趱蝈殇鏖瞟孱徕戾翦趱蜷铉殒麇栳鲥镱ㄧ旌孱徕戾呼屮趱蝈蹭┅ㄤ彐躅珈豸痱轭骘铘翦岍㈣趑鸷鼢鳟玑礤溴沐痿轱町铄舣翳蝈徜蟑备范序轭糸铉藻舡鏖翳珈豸序轭鏖翳珈豸麸犷鏖翳珈豸烘镱簪戾è忪孱溟铉ㄧ旌孱徕戾漯衡戾钿┅ㄧ旌孱徕戾衡戾钿ㄧ旌泔祜岍ㄧ旌蜥篝弪痫磲铋＇灬礅溽ㄣㄧ祯艉忾繇狃汨狎徙翦骘铘ㄣ栳颦轭悌┅翦舂躅戾篌忪孱溟铉ㄧ旌溟筢忪衡戾钿┅┅ㄤ彐礤翳镤珈豸轰轶痨狴è鏖睐鏖钿秣┅换沆遽翳泔祜怩骀弪犷溴痿怩骀弪ㄧ旌沆遽恒镬矧怩骀弪忾轰屦翳怩骀弪忾舂ㄧ旌泔祜暴ㄧ旌祜徜殇孱糸豉蝈箦翳盹溴祧殄磲趄轼麒孱翦趱蝈殇鏖瞟忾钿翳翦趱蝈殒麇栳鲥轸ㄧ旌忾钿翦趱蝈呼屮趱蝈蹭翦趱蝈殇鏖瞟┅豸殪轸殄蠛泔钿戾èㄦ蹯祗泸邋瞽鏖瞟ㄨ彘玷ㄧ祯艉珏后泸邋瞽桢殓梏┅鏖漪ㄧ祯艉珏后泸邋瞽鏖漪瑭┅ㄨ彘玷ㄧ祯艉桢殓梏鏖瞟鏖漪ㄧ祯艉鏖漪鏖瞟┅ㄧ旌鏖翳痱轫轸轹弩厚踽潴换骝镱驷沐ㄧ旌翦泔矧爱碑癌ㄧ旌鲥螋屮爱桢殓梏爱癌ㄧ旌翦泔矧碑碑癌ㄧ旌鲥螋屮鏖漪桢殓梏爱癌ㄧ旌翦泔矧碑爱癌ㄧ旌鲥螋屮鏖漪爱爱癌ㄧ旌翦泔矧爱爱癌ㄧ旌鲥螋屮爱爱爱癌┅换藻秭弪灬ㄢ矧溴狨翳蝈徜蠛徙聃轵瀛祜汶痱镯痿祜汶ㄧ祯舡痱轭卑卑珈豸韩忾繇狃弓怡钡痱镯痿暴ㄢ矧溴狨翳蝈徜蠛蝈戾狍瀛祜汶痱镯痿祜汶换篦狃翳怩骀弪镱麸翳筱蝈孱ㄧ祯艉篦狃怩骀弪螬ㄤ彐礤翳镤珈豸候弩栳疱è鏖睐鏖钿秣鏖漪桢殓梏ㄧ旌鲩鬻痫螋鏖漪桢殓梏蝈箦翳沲蝌孱鲩鬻痫螋ㄧ旌磲趄轼盹溴吼蝻赍泗轱瞟箦戾泗翳痱镪邈糸镱磲趄轼ㄧ旌祜徜殇孱糸豉蝈箦翳磲趄轼换箦疱蝮疱泗轹忉箦镱鏖钿秣狍疱泗蜥糸换ㄧ祯吼弪箴邈糸鲥吹ǒ鏖漪磲桢殓梏暴悲卑卑癌ㄧ祯猴螋栾蹭鏖漪桢殓梏换ㄦ矧磲秕⒆轭儒殓梏连组漪韬窿アㄧ祯艉桢殓梏鏖瞟ㄧ祯艉鏖漪鏖瞟换ㄦ矧磲秕⑽鬻儒殓梏连组漪韬窿ア桢殓梏鏖漪瑭箦翩ㄧ祯艉桢殓梏鏖瞟桢殓梏ㄧ祯艉鏖漪鏖瞟鏖漪瑭ㄧ旌磲趄轼盹溴喉镤屐鲩鬻箦戾泗翳盹溴祧殄磲趄轼ㄧ旌祜徜殇孱糸豉┅蝈箦翳磲趄轼ㄤ彐礤翳镤珈豸弘妁怙狎è鏖睐鏖钿秣脲ㄤ邈灬蝈ㄩ珙矧┅换描邈骘箴邈獒脲眭祠轲戾鲠祯瀛忾钿箬殒泗蜢犰舂ㄧ祯艉珏舡盹溟骈弪鲠祯弩ㄤ邈灬蝈ㄩ珙矧箬殒泗蜢┅ㄩ犰ㄣ狍脲è＼＼譬换筢鲥麒弭桢麇蝈轭骢祆筱蝈孱戾è骢祆ㄦ蹯祗泸邋瞽鏖瞟┅ㄧ祯艉溴篝蝻沲蝌孱舡鏖钿秣沆矬翳沲蝌孱鏖钿秣ㄧ祯艉溟箴灬鏖钿秣镳孱铄鏖钿秣鏖翳骢祆筱蝈孱麸珑戾磲脲轭篝犷沐ы鏖钿秣烘蹯祗泸邋铒骢祆┅┅è＼＼泰痱镧箦翩扉篝镦骈戾螵ㄧ弭扉篝镦骈戾螬换ㄦ矧磲秕⑶弭糸铉扉篝镦骈戾簋窿" *list-of-files*)
			    (setf (texture-id win)
				  (il:with-init
				    (ilut:renderer :opengl)
				    (ilut:gl-load-image (car *list-of-files*)))))))
	  
	;; No alt modifier, do normal stuff
	(case key
	  ((#\Escape) (glut:destroy-current-window))
	  (otherwise
	   (funcall *the-fsm* key))))))
	  ;; ((#\m #\M) (multiple-value-bind (shift ctrl alt) (glut:get-modifier-values)
	  ;; 		 (format out "SHIFT A%CTRL  A%alt   A%" shift ctrl alt)))
	  ;; (#\Newline (progn (rename (pop *list-of-files*) (compile-name))
	  ;; 		    (setf <names> nil)))
	  ;; (#\; (make-description))
	  ;; (otherwise
	  ;;  (let ((in-mapped (gethash key *inputmap*)))
	  ;;    (cond
	  ;;      (in-mapped (toggle-name in-mapped))
	  ;;      (t (make-name key)))))))))

;; (defmethod glut:keyboard-up ((win my-window) key xx yy)
;;   (declare (ignore xx yy))
;;   (case key
;;     ((#\q #\Q #\Escape) t)))

(defun run-it ()
  (setf *the-window* (make-instance 'my-window))
  (glut:display-window *the-window*))
